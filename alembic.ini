# Alembic 配置文件
#
# 文档: https://alembic.sqlalchemy.org/en/latest/tutorial.html

[alembic]
# alembic 迁移脚本存放目录
script_location = backend/alembic

# 迁移脚本模板文件
file_template = %%(year)d-%%(month).2d-%%(day).2d-%%(hour).2d_%%(minute).2d_%%(second).2d-%%(rev)s_%%(slug)s

# sys.path 路径（用于导入项目模块）
prepend_sys_path = .

# 时区设置（可选）
timezone = Asia/Shanghai

# 日志配置
# 最大宽度（控制台输出）
# truncate_slug_length = 40

# 设置为 true 以生成带有注释的迁移脚本
# output_encoding = utf-8

# 数据库连接字符串
# 注意: 这里留空，由 env.py 从应用配置中动态获取
# 这样可以避免在配置文件中硬编码数据库凭据
sqlalchemy.url =


[post_write_hooks]
# post_write_hooks 定义代码格式化钩子
# 这里配置自动格式化生成的迁移脚本
hooks = ruff_format

# 使用 exec 类型直接执行 shell 命令
ruff_format.type = exec

# 使用 uv run 确保使用项目虚拟环境中的 ruff
ruff_format.executable = uv
ruff_format.options = run ruff format REVISION_SCRIPT_FILENAME


# Logging configuration
[loggers]
keys = root,sqlalchemy,alembic

[handlers]
keys = console

[formatters]
keys = generic

[logger_root]
level = WARN
handlers = console
qualname =

[logger_sqlalchemy]
level = WARN
handlers =
qualname = sqlalchemy.engine

[logger_alembic]
level = INFO
handlers =
qualname = alembic

[handler_console]
class = StreamHandler
args = (sys.stderr,)
level = NOTSET
formatter = generic

[formatter_generic]
format = %(levelname)-5.5s [%(name)s] %(message)s
datefmt = %H:%M:%S
